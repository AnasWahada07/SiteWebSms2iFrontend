<div class="user-management-container">
  <!-- Header Section -->
<div class="header-section d-flex justify-content-between align-items-center flex-wrap mb-3">
  <div>
    <h2 class="page-title mb-2 mb-md-0">
      <i class="fas fa-users-cog me-2"></i>Gestion des Utilisateurs
    </h2>
  </div>

  <div class="d-flex gap-2">
    <button class="btn btn-outline-secondary" (click)="goToDashboard()">
      <i class="fas fa-arrow-left me-2"></i> Retour au Dashboard
    </button>

    <button class="btn btn-refresh btn-primary" (click)="refreshUsers()">
      <i class="fas fa-sync-alt me-2"></i> Actualiser
    </button>
  </div>
</div>


  <!-- User List Table -->
  <div class="card table-card animated fadeInUp" *ngIf="users.length > 0">
    <div class="card-body">
      <div class="table-responsive">
        <table class="table table-hover">
          <thead class="table-header">
            <tr>
              <th>ID</th>
              <th>Nom</th>
              <th>Prénom</th>
              <th>Email</th>
              <th>Rôle</th>
              <th>Organisme</th>
              <th class="text-end">Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let user of users" class="table-row">
              <td>{{ user.id }}</td>
              <td>{{ user.nom }}</td>
              <td>{{ user.prenom }}</td>
              <td><a href="mailto:{{ user.email }}" class="email-link">{{ user.email }}</a></td>
              <td>
                <span class="badge" [ngClass]="{
                  'badge-admin': user.role === 'admin',
                  'badge-user': user.role === 'user'
                }">
                  {{ user.role === 'admin' ? 'Administrateur' : 'Utilisateur' }}
                </span>
              </td>
              <td>{{ user.organisme }}</td>
              <td class="text-end">
                <button class="btn btn-action btn-edit" (click)="updateUser(user)">
                  <i class="fas fa-edit"></i> Modifier
                </button>
                <button class="btn btn-action btn-delete" (click)="deleteUser(user.id)">
                  <i class="fas fa-trash-alt"></i> Supprimer
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Empty State -->
  <div *ngIf="users.length === 0" class="empty-state animated fadeIn">
    <div class="empty-state-icon">
      <i class="fas fa-user-slash"></i>
    </div>
    <h3>Aucun utilisateur trouvé</h3>
    <p>Il n'y a actuellement aucun utilisateur dans le système.</p>
    <button class="btn btn-primary" (click)="refreshUsers()">
      <i class="fas fa-sync-alt me-2"></i>Rafraîchir
    </button>
  </div>

  <!-- Update User Form (Modal Style) -->
  <div *ngIf="selectedUser" class="modal-overlay animated fadeIn">
    <div class="modal-card">
      <div class="modal-header">
        <h4><i class="fas fa-user-edit me-2"></i>Modifier Utilisateur</h4>
        <button class="btn-close" (click)="cancelModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <form #updateForm="ngForm" (ngSubmit)="handleUserUpdate(selectedUser!)" class="modal-form">
        <div class="form-group">
          <label for="nom" class="form-label">Nom</label>
          <input id="nom" type="text" class="form-control" [(ngModel)]="selectedUser.nom" name="nom" required>
        </div>

        <div class="form-group">
          <label for="prenom" class="form-label">Prénom</label>
          <input id="prenom" type="text" class="form-control" [(ngModel)]="selectedUser.prenom" name="prenom" required>
        </div>

        <div class="form-group">
          <label for="email" class="form-label">Email</label>
          <input id="email" type="email" class="form-control" [(ngModel)]="selectedUser.email" name="email" required>
        </div>

        <div class="form-group">
          <label for="role" class="form-label">Rôle</label>
          <select id="role" class="form-select" [(ngModel)]="selectedUser.role" name="role" required>
            <option value="user">Utilisateur</option>
            <option value="admin">Administrateur</option>
          </select>
        </div>

        <div class="form-group">
          <label for="organisme" class="form-label">Organisme</label>
          <input id="organisme" type="text" class="form-control" [(ngModel)]="selectedUser.organisme" name="organisme" required>
        </div>

        <div class="form-footer">
          <button type="button" class="btn btn-cancel" (click)="cancelModal()">
            <i class="fas fa-times me-2"></i>Annuler
          </button>
          <button type="submit" class="btn btn-save">
            <i class="fas fa-save me-2"></i>Enregistrer
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<footer class="text-center py-3 bg-light border-top mt-4">
  <div class="small text-muted">
    &copy; {{ currentYear || '2025' }} <strong class="text-dark">SMS2I</strong> — Tous droits réservés.
  </div>
  <div class="small">
    Conçu <i class="bi bi-heart-fill text-danger mx-1"></i> par l’équipe <span class="text-primary fw-semibold">SMS2I</span>
  </div>
</footer>
