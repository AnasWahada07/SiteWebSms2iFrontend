<div class="projects-container">

  <!-- Barre de recherche + actions -->
  <div class="row mb-4 align-items-center">
    <div class="col-md-8 mb-2 mb-md-0">
      <input
        type="text"
        class="form-control shadow-sm"
        placeholder="üîç Rechercher par titre ou client"
        [(ngModel)]="searchQuery"
        (ngModelChange)="applyProjetFilter()" />
    </div>
    <div class="col-md-4 d-flex justify-content-md-end gap-2">
      <button class="btn btn-outline-secondary btn-sm shadow-sm" (click)="resetProjetFilter()">
        <i class="bi bi-x-circle me-1"></i> R√©initialiser Recherche
      </button>
      <button class="btn btn-outline-secondary btn-sm shadow-sm" (click)="goToDashboard()">
        <i class="bi bi-arrow-left me-1"></i> Retour au Dashboard
      </button>
    </div>
  </div>

  <!-- En-t√™te liste -->
  <div class="projects-header d-flex align-items-center justify-content-between mb-3">
    <h2 class="section-title m-0">Liste des Projets</h2>
    <div class="projects-count">{{ projets.length }} projet(s)</div>
  </div>

  <!-- Liste des projets -->
  <ul class="projects-list list-unstyled m-0 p-0">
    <li
      *ngFor="let projet of projets; let i = index"
      class="project-card"
      [style.--delay]="i * 0.05 + 's'">

      <div class="project-header d-flex align-items-center justify-content-between">
        <h3 class="project-title m-0">{{ projet.title }}</h3>
        <span class="project-duration ms-3 text-muted">{{ projet.duree }}</span>
      </div>

      <div class="project-image-container my-2">
        <img
          *ngIf="projet.imageUrl"
          [src]="projet.imageUrl"
          class="project-image img-fluid rounded"
          [alt]="'Image du projet ' + (projet.title || '')" />
        <div *ngIf="!projet.imageUrl" class="image-placeholder d-flex align-items-center justify-content-center rounded">
          <svg width="24" height="24" viewBox="0 0 24 24" aria-hidden="true">
            <path fill="currentColor"
              d="M19,19H5V5H19M19,3H5A2,2 0 0,0 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5A2,2 0 0,0 19,3M13.96,12.29L11.21,15.83L9.25,13.47L6.5,17H17.5L13.96,12.29Z" />
          </svg>
        </div>
      </div>

      <div class="project-meta d-flex flex-wrap gap-3 text-muted">
        <span *ngIf="projet.client" class="meta-item d-inline-flex align-items-center gap-1">
          <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true">
            <path fill="currentColor"
              d="M12,4A4,4 0 0,1 16,8A4,4 0 0,1 12,12A4,4 0 0,1 8,8A4,4 0 0,1 12,4M12,14C16.42,14 20,15.79 20,18V20H4V18C4,15.79 7.58,14 12,14Z" />
          </svg>
          {{ projet.client }}
        </span>

        <span *ngIf="projet.technologie" class="meta-item d-inline-flex align-items-center gap-1">
          <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true">
            <path fill="currentColor"
              d="M5,3H19A2,2 0 0,1 21,5V19A2,2 0 0,1 19,21H5A2,2 0 0,1 3,19V5A2,2 0 0,1 5,3M7,7V9H9V7H7M11,7V9H13V7H11M15,7V9H17V7H15M7,11V13H9V11H7M11,11V13H13V11H11M15,11V13H17V11H15M7,15V17H9V15H7M11,15V17H13V15H11M15,15V17H17V15H15Z" />
          </svg>
          {{ projet.technologie }}
        </span>
      </div>

      <p class="project-description my-2" *ngIf="projet.description">{{ projet.description }}</p>

      <div class="project-actions d-flex gap-2">
        <button (click)="editProjet(projet)" class="btn-edit btn btn-outline-primary btn-sm">
          <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true" class="me-1">
            <path fill="currentColor"
              d="M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z" />
          </svg>
          Modifier
        </button>

        <button (click)="deleteProjet(projet.id!)" class="btn-delete btn btn-outline-danger btn-sm">
          <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true" class="me-1">
            <path fill="currentColor"
              d="M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z" />
          </svg>
          Supprimer
        </button>
      </div>
    </li>
  </ul>

  <!-- Formulaire d'ajout -->
  <div class="form-section mt-5">
    <h3 class="section-title">Ajouter un projet</h3>

    <form (ngSubmit)="saveProjet()" class="project-form">
      <div class="form-group floating-label">
        <input [(ngModel)]="newProjet.title" name="title" id="title" placeholder=" " required />
        <label for="title">Titre*</label>
      </div>

      <div class="form-group floating-label">
        <textarea [(ngModel)]="newProjet.description" name="description" id="description" placeholder=" " required></textarea>
        <label for="description">Description*</label>
      </div>

      <div class="form-row d-flex gap-3">
        <div class="form-group floating-label flex-fill">
          <input [(ngModel)]="newProjet.duree" name="duree" id="duree" placeholder=" " />
          <label for="duree">Dur√©e</label>
        </div>
        <div class="form-group floating-label flex-fill">
          <input [(ngModel)]="newProjet.client" name="client" id="client" placeholder=" " />
          <label for="client">Client</label>
        </div>
      </div>

      <div class="form-group floating-label">
        <input [(ngModel)]="newProjet.technologie" name="technologie" id="technologie" placeholder=" " />
        <label for="technologie">Technologie</label>
      </div>

      <div class="file-upload">
        <label class="upload-button">
          <input type="file" (change)="onFileSelected($event)" accept="image/*" />
          <span class="upload-label d-inline-flex align-items-center gap-2">
            <svg width="24" height="24" viewBox="0 0 24 24" aria-hidden="true">
              <path fill="currentColor" d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z" />
            </svg>
            Choisir une image
          </span>
        </label>

        <div *ngIf="previewUrl" class="image-preview mt-2 position-relative">
          <img [src]="previewUrl" alt="Aper√ßu image" class="img-fluid rounded border" />
          <button
            type="button"
            (click)="previewUrl = null"
            class="remove-image btn btn-sm btn-outline-secondary position-absolute top-0 end-0 m-2"
            aria-label="Supprimer l'image">
            <svg width="20" height="20" viewBox="0 0 24 24" aria-hidden="true" class="me-1">
              <path fill="currentColor" d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z" />
            </svg>
            Retirer
          </button>
        </div>
      </div>

      <button type="submit" class="btn-submit btn btn-primary mt-2">
        <svg width="20" height="20" viewBox="0 0 24 24" aria-hidden="true" class="me-1">
          <path fill="currentColor" d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z" />
        </svg>
        Ajouter le projet
      </button>
    </form>
  </div>

</div>

<footer class="text-center py-3 bg-light border-top mt-4">
  <div class="small text-muted">
    &copy; {{ currentYear || '2025' }} <strong class="text-dark">SMS2I</strong> ‚Äî Tous droits r√©serv√©s.
  </div>
  <div class="small">
    Con√ßu <i class="bi bi-heart-fill text-danger mx-1"></i> par l‚Äô√©quipe
    <span class="text-primary fw-semibold">SMS2I</span>
  </div>
</footer>

<!-- ===================== MODAL BOOTSTRAP: MODIFICATION ===================== -->
<div #editProjetModal class="modal fade" tabindex="-1" aria-labelledby="editProjetLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
    <!-- ‚úÖ Rend le contenu uniquement si selectedProjet est d√©fini -->
    <div class="modal-content shadow" *ngIf="selectedProjet as sp">
      <div class="modal-header">
        <h5 class="modal-title" id="editProjetLabel">Modifier le projet</h5>
        <button type="button" class="btn-close" aria-label="Fermer" (click)="closeEditModal()"></button>
      </div>

      <form (ngSubmit)="updateProjet()">
        <div class="modal-body">
          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label" for="editTitle">Titre *</label>
              <input id="editTitle" class="form-control" [(ngModel)]="sp.title" name="editTitle" required />
            </div>
            <div class="col-md-6">
              <label class="form-label" for="editClient">Client *</label>
              <input id="editClient" class="form-control" [(ngModel)]="sp.client" name="editClient" required />
            </div>

            <div class="col-12">
              <label class="form-label" for="editDescription">Description *</label>
              <textarea id="editDescription" class="form-control" rows="3" [(ngModel)]="sp.description" name="editDescription" required></textarea>
            </div>

            <div class="col-md-6">
              <label class="form-label" for="editDuree">Dur√©e</label>
              <input id="editDuree" class="form-control" [(ngModel)]="sp.duree" name="editDuree" />
            </div>
            <div class="col-md-6">
              <label class="form-label" for="editTechnologie">Technologie</label>
              <input id="editTechnologie" class="form-control" [(ngModel)]="sp.technologie" name="editTechnologie" />
            </div>

            <div class="col-12">
              <label class="form-label" for="editImage">Image (optionnelle)</label>
              <input id="editImage" type="file" class="form-control" accept="image/*" (change)="onEditFileSelected($event)" />
              <div class="mt-2" *ngIf="editPreviewUrl || sp?.imageUrl">
                <img
                  [src]="editPreviewUrl || sp?.imageUrl"
                  alt="Aper√ßu"
                  class="img-fluid rounded border"
                  style="max-height: 200px;">
              </div>
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-outline-secondary" (click)="closeEditModal()">Annuler</button>
          <button type="submit" class="btn btn-primary">Mettre √† jour</button>
        </div>
      </form>

    </div>
  </div>
</div>
